<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - ‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <!-- FullCalendar -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <!-- SweetAlert2 for nice modals -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body { font-family: 'Kanit', sans-serif; background-color: #f8fafc; }
    .status-pending { background-color: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
    .status-confirmed { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
    .status-cancelled { background-color: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
    .tab-active { border-bottom: 3px solid #2c3e2d; color: #2c3e2d; font-weight: 600; }
    .fc-event { cursor: pointer; padding: 2px 5px; border-radius: 4px; border: none; }
    /* Hide scrollbar for Chrome, Safari and Opera */
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="min-h-screen pb-12">
  <div class="max-w-6xl mx-auto px-4 py-6">
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
      <div>
        <h1 class="text-3xl font-bold text-slate-800">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</h1>
        <p class="text-slate-500 flex items-center gap-2">
          <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
          ‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥ - Kha Nam Lung Dam Admin
        </p>
      </div>
      <div class="flex gap-3">
        <button onclick="loadAllData()" class="bg-white border border-slate-200 px-5 py-2.5 rounded-xl shadow-sm hover:bg-slate-50 transition flex items-center gap-2 font-medium text-slate-700">
          <span id="refreshIcon">üîÑ</span> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
        </button>
        <button onclick="logout()" class="bg-red-50 text-red-600 px-4 py-2.5 rounded-xl font-medium hover:bg-red-100 transition">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="flex overflow-x-auto border-b border-slate-200 mb-8 gap-8 text-slate-400 no-scrollbar">
      <button onclick="switchTab('recent')" id="tab-recent" class="pb-3 px-2 transition-all tab-active whitespace-nowrap">üïí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
      <button onclick="switchTab('all')" id="tab-all" class="pb-3 px-2 transition-all whitespace-nowrap">üìë ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
      <button onclick="switchTab('calendar')" id="tab-calendar" class="pb-3 px-2 transition-all whitespace-nowrap">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</button>
      <button onclick="switchTab('settings')" id="tab-settings" class="pb-3 px-2 transition-all whitespace-nowrap">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</button>
    </nav>

    <!-- Tab Contents -->
    <div id="loading" class="text-center py-32 hidden">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-slate-200 border-t-slate-800 mb-4"></div>
        <p class="text-slate-400 font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
    </div>

    <!-- 1. Recent Bookings -->
    <section id="content-recent" class="tab-content">
      <div id="recentList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </section>

    <!-- 2. All Bookings Table -->
    <section id="content-all" class="tab-content hidden">
      <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full text-left border-collapse">
            <thead class="bg-slate-50 text-slate-500 text-xs uppercase tracking-wider">
              <tr>
                <th class="p-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th class="p-4">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                <th class="p-4">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                <th class="p-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th class="p-4 text-right">‡∏¢‡∏≠‡∏î‡∏Ñ‡πâ‡∏≤‡∏á</th>
                <th class="p-4 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody id="allBookingsTable" class="text-sm divide-y divide-slate-50"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- 3. Calendar View -->
    <section id="content-calendar" class="tab-content hidden">
      <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100">
        <div id="calendar"></div>
      </div>
    </section>

    <!-- 4. Settings (Full Functionality Added) -->
    <section id="content-settings" class="tab-content hidden grid grid-cols-1 md:grid-cols-2 gap-8">
      
      <!-- Rooms -->
      <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
        <h3 class="font-bold text-xl mb-6 flex justify-between items-center text-slate-800">
          <span>üè† ‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</span>
          <button onclick="addItem('Rooms')" class="bg-slate-800 text-white px-3 py-1 rounded-lg text-xs font-bold hover:bg-slate-700 transition">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </h3>
        <div id="roomSettingsList" class="space-y-3"></div>
      </div>

      <!-- Foods -->
      <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
        <h3 class="font-bold text-xl mb-6 flex justify-between items-center text-slate-800">
          <span>üç≤ ‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</span>
          <button onclick="addItem('Foods')" class="bg-green-600 text-white px-3 py-1 rounded-lg text-xs font-bold hover:bg-green-700 transition">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </h3>
        <div id="foodSettingsList" class="space-y-3"></div>
      </div>

      <!-- Promotions -->
      <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
        <h3 class="font-bold text-xl mb-6 flex justify-between items-center text-slate-800">
          <span>üéüÔ∏è ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span>
          <button onclick="addItem('Promotions')" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-bold hover:bg-blue-700 transition">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </h3>
        <div id="promoSettingsList" class="space-y-3"></div>
      </div>
    </section>
  </div>

  <script>
    // --- CONFIGURATION ---
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwQjaz5oaVekrtSlw_kGqt9gLOg0uQeXphG4H2Q5cqrv4ZSEiJnzO63lctvaaYTRr9HNQ/exec';
    const ADMIN_PASS = '1234'; // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÜ (Client-side)
    
    let bookings = [];
    let masterData = {};
    let calendar;

    // --- AUTHENTICATION ---
    async function checkAuth() {
        const session = sessionStorage.getItem('adminAuth');
        if (session !== 'true') {
            const { value: password } = await Swal.fire({
                title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô',
                input: 'password',
                allowOutsideClick: false,
                confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
                confirmButtonColor: '#2c3e2d'
            });

            if (password === ADMIN_PASS) {
                sessionStorage.setItem('adminAuth', 'true');
                loadAllData();
            } else {
                await Swal.fire('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î', '', 'error');
                location.reload();
            }
        } else {
            loadAllData();
        }
    }

    function logout() {
        sessionStorage.removeItem('adminAuth');
        location.reload();
    }

    // --- DATA LOADING ---
    async function loadAllData() {
      const loading = document.getElementById('loading');
      loading.classList.remove('hidden');
      
      try {
        const [bResp, iResp] = await Promise.all([
          fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getAllBookings' }) }),
          fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getInitialData' }) })
        ]);
        
        bookings = await bResp.json();
        masterData = await iResp.json();
        
        renderRecent();
        renderAll();
        renderCalendar();
        renderSettings();
        
      } catch (e) {
        Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
      } finally {
        loading.classList.add('hidden');
      }
    }

    // --- TAB SWITCHING ---
    function switchTab(tab) {
      document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
      document.querySelectorAll('nav button').forEach(b => b.classList.remove('tab-active'));
      document.getElementById(`content-${tab}`).classList.remove('hidden');
      document.getElementById(`tab-${tab}`).classList.add('tab-active');
      if (tab === 'calendar' && calendar) setTimeout(() => calendar.render(), 100);
    }

    // --- RENDER FUNCTIONS ---
    function renderRecent() {
        const list = document.getElementById('recentList');
        const recent = [...bookings].reverse().slice(0, 9);
        list.innerHTML = recent.map(b => createBookingCard(b)).join('') || '<div class="col-span-full text-center text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>';
    }

    function createBookingCard(b) {
        const statusClass = b.status === 'Confirmed' ? 'status-confirmed' : (b.status === 'Pending' ? 'status-pending' : 'status-cancelled');
        return `
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 hover:shadow-md transition">
                <div class="flex justify-between mb-2">
                    <span class="font-bold text-slate-800">${b.name}</span>
                    <span class="px-2 py-1 text-[10px] rounded-full uppercase font-bold ${statusClass}">${b.status}</span>
                </div>
                <div class="text-xs text-slate-500 mb-4">
                    <p>üìÖ ${formatDate(b.checkIn)} - ${formatDate(b.checkOut)}</p>
                    <p>üè† ${b.rooms.map(r=>r.id).join(', ')}</p>
                </div>
                <div class="flex justify-between items-center pt-4 border-t border-slate-50">
                    <span class="font-bold text-red-500">‡∏Ñ‡πâ‡∏≤‡∏á: ‡∏ø${(b.totalPrice - b.deposit).toLocaleString()}</span>
                    <button onclick="viewDetails('${b.bookingID}')" class="bg-slate-800 text-white px-3 py-1.5 rounded-lg text-xs">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
        `;
    }

    function renderAll() {
        const tbody = document.getElementById('allBookingsTable');
        tbody.innerHTML = bookings.map(b => `
            <tr class="hover:bg-slate-50">
                <td class="p-4 text-slate-600">${formatDate(b.checkIn)}</td>
                <td class="p-4 font-medium">${b.name}</td>
                <td class="p-4 text-xs text-slate-500">${b.rooms.map(r=>r.id).join(', ')}</td>
                <td class="p-4"><span class="px-2 py-1 text-[10px] rounded-full uppercase font-bold ${b.status === 'Confirmed' ? 'status-confirmed' : (b.status === 'Pending' ? 'status-pending' : 'status-cancelled')}">${b.status}</span></td>
                <td class="p-4 text-right font-bold text-red-500">‡∏ø${(b.totalPrice - b.deposit).toLocaleString()}</td>
                <td class="p-4 text-center">
                    <button onclick="viewDetails('${b.bookingID}')" class="text-blue-600 hover:underline">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</button>
                </td>
            </tr>
        `).join('');
    }

    function renderSettings() {
        // Rooms
        document.getElementById('roomSettingsList').innerHTML = masterData.rooms.map(r => `
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100">
                <div>
                    <div class="font-bold text-sm">${r.name} (${r.id})</div>
                    <div class="text-xs text-slate-400">‡∏£‡∏≤‡∏Ñ‡∏≤: ${r.basePrice}, ‡∏û‡∏±‡∏Å: ${r.maxPax}</div>
                </div>
                <button onclick="deleteItem('Rooms', '${r.id}')" class="text-red-400 hover:text-red-600">üóëÔ∏è</button>
            </div>
        `).join('');
        
        // Foods
        document.getElementById('foodSettingsList').innerHTML = masterData.foods.map(f => `
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100">
                <div class="flex items-center gap-3">
                    <div class="font-bold text-sm">${f.name}</div>
                    <div class="text-xs text-green-600">‡∏ø${f.price}</div>
                </div>
                <button onclick="deleteItem('Foods', '${f.id}')" class="text-red-400 hover:text-red-600">üóëÔ∏è</button>
            </div>
        `).join('');

        // Promos
        document.getElementById('promoSettingsList').innerHTML = masterData.promotions.map(p => `
            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-xl border border-slate-100">
                <div>
                    <div class="font-bold text-sm tracking-widest">${p.code}</div>
                    <div class="text-xs text-blue-600">‡∏•‡∏î ${p.value}${p.type==='percent'?'%':'‡∏ø'}</div>
                </div>
                <button onclick="deleteItem('Promotions', '${p.code}')" class="text-red-400 hover:text-red-600">üóëÔ∏è</button>
            </div>
        `).join('');
    }

    // --- ACTIONS (ADD/DELETE) ---
    async function addItem(type) {
        let htmlForm = '';
        if (type === 'Rooms') {
            htmlForm = `
                <input id="swal-id" class="swal2-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô A1)">
                <input id="swal-name" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å">
                <input id="swal-type" class="swal2-input" placeholder="‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (House/Camp)">
                <input id="swal-pax" type="number" class="swal2-input" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î">
                <input id="swal-price" type="number" class="swal2-input" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô">
            `;
        } else if (type === 'Foods') {
            htmlForm = `
                <input id="swal-id" class="swal2-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏≤‡∏´‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô F01)">
                <input id="swal-name" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π">
                <input id="swal-price" type="number" class="swal2-input" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤">
            `;
        } else if (type === 'Promotions') {
            htmlForm = `
                <input id="swal-id" class="swal2-input" placeholder="‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡πÄ‡∏ä‡πà‡∏ô SUMMER10)">
                <input id="swal-val" type="number" class="swal2-input" placeholder="‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î">
                <select id="swal-type" class="swal2-input"><option value="percent">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå (%)</option><option value="fixed">‡∏ö‡∏≤‡∏ó</option></select>
            `;
        }

        const { value: formValues } = await Swal.fire({
            title: `‡πÄ‡∏û‡∏¥‡πà‡∏° ${type}`,
            html: htmlForm,
            focusConfirm: false,
            showCancelButton: true,
            confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
            preConfirm: () => {
                if (type === 'Rooms') return [document.getElementById('swal-id').value, document.getElementById('swal-name').value, document.getElementById('swal-type').value, document.getElementById('swal-pax').value, document.getElementById('swal-price').value, '{}', ''];
                if (type === 'Foods') return [document.getElementById('swal-id').value, document.getElementById('swal-name').value, document.getElementById('swal-price').value];
                if (type === 'Promotions') return [document.getElementById('swal-id').value, document.getElementById('swal-val').value, document.getElementById('swal-type').value, ''];
            }
        });

        if (formValues) {
            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', didOpen: () => Swal.showLoading() });
            const payload = type === 'Rooms' ? {0:formValues[0],1:formValues[1],2:formValues[2],3:formValues[3],4:formValues[4],5:formValues[5],6:formValues[6]} :
                            type === 'Foods' ? {0:formValues[0],1:formValues[1],2:formValues[2]} : {0:formValues[0],1:formValues[1],2:formValues[2],3:formValues[3]};
            
            await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'manageMasterData', type: type, operation: 'add', payload: payload })
            });
            await loadAllData();
            Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }
    }

    async function deleteItem(type, id) {
        const result = await Swal.fire({
            title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?',
            text: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö ${id} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            confirmButtonText: '‡∏•‡∏ö‡πÄ‡∏•‡∏¢'
        });

        if (result.isConfirmed) {
            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...', didOpen: () => Swal.showLoading() });
            await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: 'manageMasterData', type: type, operation: 'delete', id: id })
            });
            await loadAllData();
            Swal.fire('‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', '', 'success');
        }
    }

    async function viewDetails(id) {
        // Simple alert for now, can be expanded like original code
        const b = bookings.find(x => x.bookingID === id);
        const action = await Swal.fire({
            title: b.name,
            html: `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b>${b.status}</b><br>‡∏™‡∏•‡∏¥‡∏õ: <a href="${b.slipUrl}" target="_blank">‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</a>`,
            showDenyButton: true,
            showCancelButton: true,
            confirmButtonText: '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á',
            denyButtonText: 'üö´ ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å/‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò',
            cancelButtonText: '‡∏õ‡∏¥‡∏î'
        });

        if (action.isConfirmed) updateStatus(id, 'Confirmed');
        else if (action.isDenied) updateStatus(id, 'Cancelled');
    }

    async function updateStatus(id, status) {
        Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï...', didOpen: () => Swal.showLoading() });
        await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'updateBookingStatus', bookingID: id, status: status })
        });
        loadAllData();
        Swal.fire('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô ${status} ‡πÅ‡∏•‡πâ‡∏ß`, 'success');
    }

    function renderCalendar() {
      const calendarEl = document.getElementById('calendar');
      const events = bookings.filter(b => b.status !== 'Cancelled').map(b => ({
        title: `${b.name}`, start: b.checkIn, end: b.checkOut,
        backgroundColor: b.status === 'Confirmed' ? '#166534' : '#f59e0b'
      }));

      if (calendar) calendar.destroy();
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth', locale: 'th', events: events, height: 600
      });
      calendar.render();
    }

    function formatDate(dateStr) {
        return new Date(dateStr).toLocaleDateString('th-TH', {day:'numeric', month:'short'});
    }

    // Init
    window.onload = checkAuth;
  </script>
</body>
</html>
