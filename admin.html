<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô - ‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥ ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');
        body { font-family: 'Kanit', sans-serif; background-color: #f3f4f6; }
        .calendar-day { min-height: 80px; }
        @media(max-width: 640px){ .calendar-day { min-height: 50px; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwQjaz5oaVekrtSlw_kGqt9gLOg0uQeXphG4H2Q5cqrv4ZSEiJnzO63lctvaaYTRr9HNQ/exec"; 

        const compressImage = async (file) => {
            return new Promise((resolve, reject) => {
                const maxWidth = 800;
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        if (width > maxWidth) {
                            height *= maxWidth / width;
                            width = maxWidth;
                        }
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.7)); 
                    };
                    img.onerror = (err) => reject(err);
                };
                reader.onerror = (err) => reject(err);
            });
        };

        const StatusBadge = ({ status }) => {
            let color = 'bg-gray-100 text-gray-800';
            if (status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö') color = 'bg-yellow-100 text-yellow-800';
            if (status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô') color = 'bg-green-100 text-green-800';
            if (status && status.includes('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')) color = 'bg-red-100 text-red-800';
            return <span className={`px-2 py-1 rounded text-xs font-bold border ${color}`}>{status}</span>;
        };

        const AdminApp = () => {
            const [isLoggedIn, setIsLoggedIn] = React.useState(false);
            const [password, setPassword] = React.useState('');
            const [loading, setLoading] = React.useState(false);
            const [activeTab, setActiveTab] = React.useState('dashboard');
            
            const [bookings, setBookings] = React.useState([]);
            
            // System Settings
            const [settings, setSettings] = React.useState({ discounts: [], closed: [], special: [] });
            
            // Site Settings
            const [siteSettings, setSiteSettings] = React.useState(null);
            const [savingSiteSettings, setSavingSiteSettings] = React.useState(false);
            
            const [viewSlip, setViewSlip] = React.useState(null); 
            const [viewBooking, setViewBooking] = React.useState(null); 
            const [filter, setFilter] = React.useState('all'); 

            const [rescheduleData, setRescheduleData] = React.useState(null);
            
            // Add Food States
            const [selectedAddFood, setSelectedAddFood] = React.useState('');
            const [addFoodQty, setAddFoodQty] = React.useState(1);

            const [editMode, setEditMode] = React.useState(null); 
            const [formDiscount, setFormDiscount] = React.useState({ code: '', type: 'FIXED', value: '' });
            const [formClosed, setFormClosed] = React.useState({ date: '', reason: '' });
            const [formSpecial, setFormSpecial] = React.useState({ date: '', desc: '' });

            // Calendar State (Lifted up)
            const [calendarDate, setCalendarDate] = React.useState(new Date());

            const formatThaiDate = (dateStr) => {
                if(!dateStr || dateStr === '-') return "-";
                const date = new Date(dateStr);
                const months = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
                return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear() + 543}`;
            };

            const stats = React.useMemo(() => {
                const now = new Date();
                const currentMonth = now.getMonth();
                const currentYear = now.getFullYear();

                const totalRevenue = bookings
                    .filter(b => b.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô')
                    .reduce((sum, b) => sum + parseInt(b.deposit || 0), 0);

                const monthlyRevenue = bookings
                    .filter(b => {
                        const d = new Date(b.checkIn);
                        return b.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' && d.getMonth() === currentMonth && d.getFullYear() === currentYear;
                    })
                    .reduce((sum, b) => sum + parseInt(b.deposit || 0), 0);

                const pendingCount = bookings.filter(b => b.status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö').length;
                
                const monthlyCounts = Array(12).fill(0);
                bookings.forEach(b => {
                    if (b.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' && b.status !== 'Cancelled') {
                        const d = new Date(b.checkIn);
                        if (d.getFullYear() === currentYear) {
                            monthlyCounts[d.getMonth()]++;
                        }
                    }
                });

                const upcoming = bookings.filter(b => {
                    const checkIn = new Date(b.checkIn);
                    const diffTime = checkIn - now;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                    return b.status === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' && diffDays >= 0 && diffDays <= 3;
                }).sort((a,b) => new Date(a.checkIn) - new Date(b.checkIn));

                return { totalRevenue, monthlyRevenue, pendingCount, monthlyCounts, upcoming };
            }, [bookings]);

            const handleLogin = (e) => {
                e.preventDefault();
                setLoading(true);
                fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'adminLogin', password: password }) })
                .then(r => r.json()).then(res => {
                    setLoading(false);
                    if (res.status === 'success') {
                        setIsLoggedIn(true);
                        fetchData();
                        fetchSettings();
                    } else alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                }).catch(err => { setLoading(false); alert('Error: ' + err); });
            };

            const fetchData = () => {
                setLoading(true);
                fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getAdminData', password: password }) })
                .then(r => r.json()).then(res => {
                    setLoading(false);
                    if (res.status === 'success') setBookings(res.data);
                });
            };

            const fetchSettings = () => {
                fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getSettings', password: password }) })
                .then(r => r.json()).then(res => { if (res.status === 'success') setSettings(res); });
                
                fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getSiteSettings', password: password }) })
                .then(r => r.json()).then(res => { if (res.status === 'success') setSiteSettings(res.data); });
            };

            const updateStatus = (id, newStatus) => {
                if(!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "${newStatus}"?`)) return;
                setBookings(prev => prev.map(b => b.id === id ? {...b, status: newStatus} : b));
                fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'updateStatus', bookingId: id, newStatus: newStatus, password: password }) });
            };

            const handleReschedule = () => {
                if(!rescheduleData.checkIn || !rescheduleData.checkOut) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà');
                if(rescheduleData.checkIn >= rescheduleData.checkOut) return alert('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤');
                if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å?')) return;

                fetch(GOOGLE_SCRIPT_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ 
                        action: 'rescheduleBooking', 
                        bookingId: rescheduleData.id, 
                        newCheckIn: rescheduleData.checkIn, 
                        newCheckOut: rescheduleData.checkOut, 
                        password: password 
                    }) 
                }).then(r => r.json()).then(res => {
                    if (res.status === 'success') { 
                        alert('‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); 
                        setRescheduleData(null); 
                        setViewBooking(null);
                        fetchData(); 
                    } else alert('‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + res.message);
                });
            };

            const handleAddFood = () => {
                if(!selectedAddFood) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£');
                if(addFoodQty <= 0) return alert('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0');
                
                const foodItem = siteSettings.foodMenu.find(f => f.id === selectedAddFood);
                if(!foodItem) return;

                if(!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° ${foodItem.name} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${addFoodQty} ‡∏ä‡∏∏‡∏î?`)) return;

                setLoading(true);
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({
                        action: 'addFoodToBooking',
                        bookingId: viewBooking.id,
                        foodItem: { id: foodItem.id, name: foodItem.name, price: foodItem.price, qty: parseInt(addFoodQty) },
                        password: password
                    })
                }).then(r => r.json()).then(res => {
                    setLoading(false);
                    if(res.status === 'success') {
                        alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß');
                        fetchData(); // Refresh Data
                        setViewBooking(null); // Close Modal to Refresh View
                    } else {
                        alert('Error: ' + res.message);
                    }
                });
            };

            const handleSaveSetting = (type, payload) => {
                const action = editMode ? 'editSetting' : 'addSetting';
                const id = editMode ? editMode.id : null;
                if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å?')) return;
                fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action, type, id, payload, password: password }) })
                .then(r => r.json()).then(res => {
                    if (res.status === 'success') { 
                        alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); 
                        fetchSettings(); 
                        setEditMode(null);
                        setFormDiscount({ code: '', type: 'FIXED', value: '' });
                        setFormClosed({ date: '', reason: '' });
                        setFormSpecial({ date: '', desc: '' });
                    } else alert('Error');
                });
            };

            const startEdit = (type, item) => {
                setEditMode(item);
                if(type === 'discount') setFormDiscount({ code: item.code, type: item.type, value: item.value });
                if(type === 'closed') setFormClosed({ date: item.date, reason: item.reason });
                if(type === 'special') setFormSpecial({ date: item.date, desc: item.desc });
            };

            const handleDeleteSetting = (type, id) => {
                if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?')) return;
                fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'deleteSetting', type, id, password: password }) })
                .then(r => r.json()).then(res => { if (res.status === 'success') fetchSettings(); });
            };

            const handleSaveSiteSettings = () => {
                if(!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤?')) return;
                setSavingSiteSettings(true);
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'saveSiteSettings', password: password, settings: siteSettings })
                }).then(r => r.json()).then(res => {
                    setSavingSiteSettings(false);
                    if(res.status === 'success') { alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); fetchSettings(); } 
                    else alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                });
            };

            const handleImageUpload = async (file, callback) => {
                if(file) {
                    try {
                        const base64 = await compressImage(file);
                        callback(base64);
                    } catch(e) { alert('Upload Failed'); }
                }
            };

            const handleMultipleImageUpload = async (files, callback) => {
                if (!files || files.length === 0) return;
                try {
                    const promises = Array.from(files).map(file => compressImage(file));
                    const base64List = await Promise.all(promises);
                    callback(base64List);
                } catch(e) { alert('Upload Failed'); }
            };

            const handleExport = () => {
                const header = ["BookingID", "Date", "Customer", "Phone", "CheckIn", "CheckOut", "Rooms", "Total", "Deposit", "Status"];
                const rows = bookings.map(b => [
                    b.id, b.timestamp, `"${b.name}"`, `'${b.phone}`, b.checkIn, b.checkOut, `"${b.rooms.replace(/"/g, '""')}"`, b.price, b.deposit, b.status
                ]);
                const csvContent = [header.join(","), ...rows.map(r => r.join(","))].join("\n");
                const blob = new Blob(["\uFEFF"+csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.setAttribute("href", url);
                link.setAttribute("download", "bookings_lungdam.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            // Calendar Helper
            const getDaysInMonth = (date) => new Date(date.getFullYear(), date.getMonth() + 1, 0).getDate();
            const firstDayOfMonth = new Date(calendarDate.getFullYear(), calendarDate.getMonth(), 1).getDay();
            const days = [];
            for(let i=0; i<firstDayOfMonth; i++) days.push(null);
            for(let i=1; i<=getDaysInMonth(calendarDate); i++) days.push(i);
            const getBookingsForDate = (day) => {
                if(!day) return [];
                const dateStr = `${calendarDate.getFullYear()}-${String(calendarDate.getMonth()+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                return bookings.filter(b => b.status !== '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' && b.checkIn <= dateStr && b.checkOut > dateStr);
            };

            if (!isLoggedIn) return (
                <div className="min-h-screen flex items-center justify-center bg-gray-900 px-4">
                    <div className="bg-white p-8 rounded-xl shadow-2xl w-full max-w-sm">
                        <div className="text-center mb-6"><h1 className="text-3xl font-bold text-green-800">Admin Panel</h1><p className="text-gray-500">‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥ ‡πÅ‡∏Ñ‡∏°‡∏õ‡πå‡∏õ‡∏¥‡πâ‡∏á</p></div>
                        <form onSubmit={handleLogin} className="space-y-4">
                            <input type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" className="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" value={password} onChange={e => setPassword(e.target.value)} />
                            <button disabled={loading} className="w-full bg-gray-800 text-white p-3 rounded-lg hover:bg-gray-700 transition font-bold shadow-lg">{loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...' : '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö'}</button>
                        </form>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen pb-20 bg-gray-100">
                    <nav className="bg-white shadow p-3 sticky top-0 z-20 flex justify-between items-center">
                        <div className="font-bold text-lg text-green-800">üèïÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</div>
                        <div className="flex gap-2">
                            <button onClick={fetchData} className="w-8 h-8 bg-gray-100 rounded-full text-gray-600"><i className="fas fa-sync"></i></button>
                            <button onClick={() => window.location.reload()} className="w-8 h-8 bg-red-50 rounded-full text-red-500"><i className="fas fa-power-off"></i></button>
                        </div>
                    </nav>

                    <div className="max-w-7xl mx-auto p-3 md:p-6">
                        <div className="flex gap-2 mb-4 overflow-x-auto">
                            <button onClick={() => setActiveTab('dashboard')} className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${activeTab==='dashboard'?'bg-green-600 text-white':'bg-white text-gray-600 shadow'}`}>üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
                            <button onClick={() => setActiveTab('bookings')} className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${activeTab==='bookings'?'bg-green-600 text-white':'bg-white text-gray-600 shadow'}`}>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
                            <button onClick={() => setActiveTab('calendar')} className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${activeTab==='calendar'?'bg-green-600 text-white':'bg-white text-gray-600 shadow'}`}>üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</button>
                            <button onClick={() => setActiveTab('settings')} className={`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap ${activeTab==='settings'?'bg-green-600 text-white':'bg-white text-gray-600 shadow'}`}>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</button>
                        </div>

                        {/* --- DASHBOARD TAB --- */}
                        {activeTab === 'dashboard' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-green-500">
                                        <div className="text-gray-500 text-xs">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏° (‡∏°‡∏±‡∏î‡∏à‡∏≥)</div>
                                        <div className="text-2xl font-bold text-green-700">{stats.totalRevenue.toLocaleString()} ‡∏ø</div>
                                    </div>
                                    <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-blue-500">
                                        <div className="text-gray-500 text-xs">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
                                        <div className="text-2xl font-bold text-blue-700">{stats.monthlyRevenue.toLocaleString()} ‡∏ø</div>
                                    </div>
                                    <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-yellow-500">
                                        <div className="text-gray-500 text-xs">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</div>
                                        <div className="text-2xl font-bold text-yellow-600">{stats.pendingCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
                                    </div>
                                    <div className="bg-white p-4 rounded-xl shadow-sm border-l-4 border-gray-500">
                                        <div className="text-gray-500 text-xs">‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                                        <div className="text-2xl font-bold text-gray-700">{bookings.length}</div>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="bg-white p-6 rounded-xl shadow-sm">
                                        <h3 className="font-bold text-gray-700 mb-4">‡∏¢‡∏≠‡∏î‡∏à‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏õ‡∏µ‡∏ô‡∏µ‡πâ)</h3>
                                        <div className="flex items-end gap-2 h-40">
                                            {stats.monthlyCounts.map((count, i) => (
                                                <div key={i} className="flex-1 flex flex-col items-center group">
                                                    <div className="w-full bg-green-200 rounded-t hover:bg-green-400 transition-all relative" style={{ height: `${count > 0 ? (count / Math.max(...stats.monthlyCounts)) * 100 : 2}%` }}>
                                                        <span className="absolute -top-6 left-1/2 -translate-x-1/2 text-xs bg-gray-800 text-white px-1 rounded opacity-0 group-hover:opacity-100 transition">{count}</span>
                                                    </div>
                                                    <div className="text-[10px] text-gray-400 mt-1">{["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."][i]}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="bg-white p-6 rounded-xl shadow-sm">
                                        <h3 className="font-bold text-gray-700 mb-4">‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ (3 ‡∏ß‡∏±‡∏ô)</h3>
                                        <div className="space-y-3 overflow-y-auto max-h-40">
                                            {stats.upcoming.length === 0 && <p className="text-gray-400 text-sm text-center py-4">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</p>}
                                            {stats.upcoming.map(b => (
                                                <div key={b.id} onClick={()=>setViewBooking(b)} className="flex justify-between items-center p-2 bg-green-50 rounded cursor-pointer hover:bg-green-100">
                                                    <div>
                                                        <div className="font-bold text-sm text-gray-800">{b.name}</div>
                                                        <div className="text-xs text-green-700">{formatThaiDate(b.checkIn)}</div>
                                                    </div>
                                                    <div className="text-xs bg-white px-2 py-1 rounded border border-green-200">{b.rooms.split(',')[0].substring(0, 15)}...</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* --- BOOKINGS TAB --- */}
                        {activeTab === 'bookings' && (
                            <div>
                                <div className="flex gap-2 mb-4 overflow-x-auto pb-1 items-center justify-between">
                                    <div className="flex gap-2">
                                        {['all', 'pending', 'confirmed'].map(f => (
                                            <button key={f} onClick={() => setFilter(f)} className={`px-3 py-1 rounded-full text-xs font-bold whitespace-nowrap ${filter === f ? 'bg-gray-800 text-white' : 'bg-white text-gray-600 border'}`}>
                                                {f === 'all' ? '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' : (f === 'pending' ? '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' : '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß')}
                                            </button>
                                        ))}
                                    </div>
                                    <button onClick={handleExport} className="px-3 py-1 bg-green-600 text-white rounded-full text-xs font-bold hover:bg-green-700 shadow-md">
                                        <i className="fas fa-file-excel mr-1"></i> Export
                                    </button>
                                </div>
                                <div className="space-y-3">
                                    {bookings.filter(b => filter==='all' || (filter==='pending' && b.status==='‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö') || (filter==='confirmed' && b.status==='‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô')).map(b => (
                                        <div key={b.id} className="bg-white rounded-lg shadow p-4 border-l-4 border-green-500 relative">
                                            <div className="flex justify-between items-start mb-2">
                                                <div>
                                                    <div className="text-xs text-gray-400 font-mono">{b.id} | {b.timestamp.split(' ')[0]}</div>
                                                    <div className="font-bold text-lg">{b.name}</div>
                                                </div>
                                                <StatusBadge status={b.status} />
                                            </div>
                                            <div className="text-sm text-gray-600 mb-2">
                                                <div className="flex items-center gap-2"><i className="fas fa-phone w-4"></i> <a href={`tel:${b.phone}`}>{b.phone}</a></div>
                                                <div className="flex items-center gap-2"><i className="fab fa-line w-4"></i> {b.lineProfile}</div>
                                            </div>
                                            <div className="bg-gray-50 p-2 rounded text-sm mb-2">
                                                <div className="flex justify-between"><span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å:</span> <b>{formatThaiDate(b.checkIn)}</b></div>
                                                <div className="flex justify-between"><span>‡∏Ñ‡∏∑‡∏ô‡∏´‡πâ‡∏≠‡∏á:</span> <b>{formatThaiDate(b.checkOut)}</b></div>
                                                <hr className="my-2 border-gray-200"/>
                                                <div className="font-medium text-green-800 text-sm whitespace-pre-wrap">{b.rooms}</div>
                                                {b.food !== '-' && <div className="text-orange-600 text-xs mt-1">üçΩÔ∏è {b.food}</div>}
                                            </div>
                                            <div className="flex justify-between items-end">
                                                <div className="text-left"><div className="text-xs text-gray-400">‡∏°‡∏±‡∏î‡∏à‡∏≥</div><div className="font-bold text-red-600 text-lg">{parseInt(b.deposit).toLocaleString()}</div></div>
                                                <div className="flex gap-2">
                                                    {b.slip.includes('http') && <button onClick={() => setViewSlip(b.slip)} className="bg-blue-50 text-blue-600 p-2 rounded hover:bg-blue-100"><i className="fas fa-image"></i> ‡∏™‡∏•‡∏¥‡∏õ</button>}
                                                    <button onClick={() => { setViewBooking(b); }} className="bg-orange-50 text-orange-600 p-2 rounded hover:bg-orange-100"><i className="fas fa-calendar-alt"></i></button>
                                                    {b.status === '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' && (
                                                        <>
                                                            <button onClick={() => updateStatus(b.id, '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô')} className="bg-green-600 text-white p-2 rounded hover:bg-green-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                                                            <button onClick={() => updateStatus(b.id, '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å')} className="bg-red-50 text-red-500 p-2 rounded hover:bg-red-100">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                                        </>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* --- CALENDAR TAB --- */}
                        {activeTab === 'calendar' && (
                            <div className="bg-white rounded-lg shadow p-4">
                                <div className="flex justify-between items-center mb-4">
                                    <button onClick={()=>setCalendarDate(new Date(calendarDate.setMonth(calendarDate.getMonth()-1)))} className="p-2 bg-gray-100 rounded hover:bg-gray-200"><i className="fas fa-chevron-left"></i></button>
                                    <h2 className="text-xl font-bold">{calendarDate.toLocaleString('th-TH', { month: 'long', year: 'numeric' })}</h2>
                                    <button onClick={()=>setCalendarDate(new Date(calendarDate.setMonth(calendarDate.getMonth()+1)))} className="p-2 bg-gray-100 rounded hover:bg-gray-200"><i className="fas fa-chevron-right"></i></button>
                                </div>
                                <div className="grid grid-cols-7 gap-1 text-center text-xs md:text-sm font-bold bg-gray-200 p-2 rounded-t">
                                    <div>‡∏≠‡∏≤</div><div>‡∏à</div><div>‡∏≠</div><div>‡∏û</div><div>‡∏û‡∏§</div><div>‡∏®</div><div>‡∏™</div>
                                </div>
                                <div className="grid grid-cols-7 gap-1 border-l border-b border-gray-200">
                                    {days.map((day, idx) => {
                                        const dayBookings = getBookingsForDate(day);
                                        return (
                                            <div key={idx} className="border-t border-r border-gray-200 calendar-day p-1 relative">
                                                {day && <div className="text-right text-xs text-gray-500 mb-1">{day}</div>}
                                                {dayBookings.map(b => (
                                                    <div key={b.id} onClick={()=>setViewBooking(b)} className={`text-[10px] p-1 rounded mb-1 truncate cursor-pointer text-white ${b.status==='‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô'?'bg-green-500':'bg-yellow-500'}`}>{b.name}</div>
                                                ))}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* --- SETTINGS TAB --- */}
                        {activeTab === 'settings' && (
                            <div className="space-y-8">
                                {/* Site Configuration */}
                                {siteSettings && (
                                    <div className="bg-white rounded-lg shadow p-6 border-l-4 border-blue-500">
                                        <div className="flex justify-between items-center mb-6 border-b pb-4">
                                            <h2 className="text-xl font-bold text-gray-800"><i className="fas fa-store mr-2"></i>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô (Store Config)</h2>
                                            <button onClick={handleSaveSiteSettings} disabled={savingSiteSettings} className="bg-blue-600 text-white px-4 py-2 rounded shadow hover:bg-blue-700 disabled:bg-gray-400">
                                                {savingSiteSettings ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô'}
                                            </button>
                                        </div>

                                        {/* General Info */}
                                        <div className="mb-8">
                                            <h3 className="font-bold text-lg mb-4 text-blue-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                                <div>
                                                    <label className="block text-sm font-bold mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô (Title)</label>
                                                    <input className="w-full border p-2 rounded" value={siteSettings.headerTitle} onChange={e => setSiteSettings({...siteSettings, headerTitle: e.target.value})} />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold mb-1">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡πâ‡∏≤‡∏ô (Description)</label>
                                                    <textarea className="w-full border p-2 rounded" rows="3" value={siteSettings.headerDesc} onChange={e => setSiteSettings({...siteSettings, headerDesc: e.target.value})}></textarea>
                                                </div>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label className="block text-sm font-bold mb-1">‡∏£‡∏π‡∏õ‡πÇ‡∏•‡πÇ‡∏Å‡πâ (Logo)</label>
                                                    <div className="flex items-center gap-4">
                                                        <img src={siteSettings.logoUrl} className="w-16 h-16 rounded-full border object-cover bg-gray-100" />
                                                        <input type="file" onChange={e => handleImageUpload(e.target.files[0], base64 => setSiteSettings({...siteSettings, logoUrl: base64}))} className="text-sm w-full" />
                                                    </div>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-bold mb-1">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå (Banner)</label>
                                                    <div className="flex items-center gap-4">
                                                        <img src={siteSettings.bannerUrl} className="w-32 h-16 rounded border object-cover bg-gray-100" />
                                                        <input type="file" onChange={e => handleImageUpload(e.target.files[0], base64 => setSiteSettings({...siteSettings, bannerUrl: base64}))} className="text-sm w-full" />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Room Images */}
                                        <div className="mb-8">
                                            <h3 className="font-bold text-lg mb-4 text-blue-600">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</h3>
                                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                                {['R1','R2','R3','T1','T2','K1','K2','Z8'].map(roomId => (
                                                    <div key={roomId} className="border p-3 rounded bg-gray-50 flex flex-col h-full">
                                                        <h4 className="font-bold mb-2 text-sm">{roomId}</h4>
                                                        
                                                        {/* ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á */}
                                                        <textarea
                                                            className="w-full border p-1 rounded text-xs mb-2 resize-none h-16"
                                                            placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å..."
                                                            value={siteSettings.roomDescriptions?.[roomId] || ''}
                                                            onChange={e => {
                                                                const newDesc = {...(siteSettings.roomDescriptions || {})};
                                                                newDesc[roomId] = e.target.value;
                                                                setSiteSettings({...siteSettings, roomDescriptions: newDesc});
                                                            }}
                                                        ></textarea>

                                                        <div className="flex flex-wrap gap-2 mb-2 flex-grow">
                                                            {(siteSettings.roomImages[roomId] || []).map((img, idx) => (
                                                                <div key={idx} className="relative w-12 h-12">
                                                                    <img src={img} className="w-full h-full object-cover rounded" />
                                                                    <button onClick={() => {
                                                                        const newImgs = siteSettings.roomImages[roomId].filter((_, i) => i !== idx);
                                                                        setSiteSettings({...siteSettings, roomImages: {...siteSettings.roomImages, [roomId]: newImgs}});
                                                                    }} className="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-4 h-4 text-[10px] flex items-center justify-center">√ó</button>
                                                                </div>
                                                            ))}
                                                        </div>
                                                        <input 
                                                            type="file" 
                                                            multiple 
                                                            className="text-[10px] w-full mt-auto" 
                                                            onChange={e => handleMultipleImageUpload(e.target.files, base64List => {
                                                                const current = siteSettings.roomImages[roomId] || [];
                                                                setSiteSettings({...siteSettings, roomImages: {...siteSettings.roomImages, [roomId]: [...current, ...base64List]}});
                                                            })} 
                                                        />
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Food Menu */}
                                        <div>
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="font-bold text-lg text-blue-600">‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h3>
                                                <button onClick={() => {
                                                    const newFood = { id: 'F'+Date.now(), name: '‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡∏°‡πà', price: 0, img: '', desc: '' };
                                                    setSiteSettings({...siteSettings, foodMenu: [...siteSettings.foodMenu, newFood]});
                                                }} className="bg-blue-100 text-blue-600 px-3 py-1 rounded text-sm hover:bg-blue-200">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π</button>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {siteSettings.foodMenu.map((food, idx) => (
                                                    <div key={food.id} className="border p-3 rounded flex gap-3 bg-white items-start">
                                                        <div className="w-16 h-16 bg-gray-200 rounded flex-shrink-0 relative overflow-hidden group">
                                                            {food.img ? <img src={food.img} className="w-full h-full object-cover" /> : <div className="flex items-center justify-center h-full text-gray-400 text-xs">No Img</div>}
                                                            <input type="file" className="absolute inset-0 opacity-0 cursor-pointer" onChange={e => handleImageUpload(e.target.files[0], base64 => {
                                                                const newFoods = [...siteSettings.foodMenu];
                                                                newFoods[idx].img = base64;
                                                                setSiteSettings({...siteSettings, foodMenu: newFoods});
                                                            })} />
                                                        </div>
                                                        <div className="flex-1 space-y-1">
                                                            <input className="w-full border p-1 rounded text-sm" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π" value={food.name} onChange={e => {
                                                                const newFoods = [...siteSettings.foodMenu];
                                                                newFoods[idx].name = e.target.value;
                                                                setSiteSettings({...siteSettings, foodMenu: newFoods});
                                                            }} />
                                                            <textarea
                                                                className="w-full border p-1 rounded text-xs resize-none"
                                                                rows="2"
                                                                placeholder="‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏´‡∏≤‡∏£..."
                                                                value={food.desc || ''}
                                                                onChange={e => {
                                                                    const newFoods = [...siteSettings.foodMenu];
                                                                    newFoods[idx].desc = e.target.value;
                                                                    setSiteSettings({...siteSettings, foodMenu: newFoods});
                                                                }}
                                                            ></textarea>
                                                            <div className="flex items-center gap-2">
                                                                <input type="number" className="w-20 border p-1 rounded text-sm" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" value={food.price} onChange={e => {
                                                                    const newFoods = [...siteSettings.foodMenu];
                                                                    newFoods[idx].price = parseInt(e.target.value) || 0;
                                                                    setSiteSettings({...siteSettings, foodMenu: newFoods});
                                                                }} />
                                                                <span className="text-sm text-gray-500">‡∏ö‡∏≤‡∏ó</span>
                                                            </div>
                                                        </div>
                                                        <button onClick={() => {
                                                            const newFoods = siteSettings.foodMenu.filter((_, i) => i !== idx);
                                                            setSiteSettings({...siteSettings, foodMenu: newFoods});
                                                        }} className="text-red-500 hover:text-red-700"><i className="fas fa-trash"></i></button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* System Settings */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    {/* Discount Code */}
                                    <div className="bg-white p-4 rounded-lg shadow border-l-4 border-green-500">
                                        <h3 className="font-bold text-lg mb-4 text-green-800"><i className="fas fa-tags"></i> ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</h3>
                                        <div className="flex gap-2 mb-4 flex-wrap items-end bg-gray-50 p-2 rounded">
                                            <div><label className="text-xs text-gray-500">Code</label><input className="border p-2 rounded text-sm w-24 block" value={formDiscount.code} onChange={e=>setFormDiscount({...formDiscount, code:e.target.value})} /></div>
                                            <div><label className="text-xs text-gray-500">Type</label><select className="border p-2 rounded text-sm block" value={formDiscount.type} onChange={e=>setFormDiscount({...formDiscount, type:e.target.value})}><option value="FIXED">‡∏ö‡∏≤‡∏ó</option><option value="PERCENT">%</option></select></div>
                                            <div><label className="text-xs text-gray-500">Value</label><input type="number" className="border p-2 rounded text-sm w-20 block" value={formDiscount.value} onChange={e=>setFormDiscount({...formDiscount, value:e.target.value})} /></div>
                                            <button onClick={()=>handleSaveSetting('discount', formDiscount)} className={`px-3 py-2 rounded text-sm text-white ${editMode?.code===formDiscount.code ? 'bg-orange-500':'bg-green-600'}`}>{editMode?.code===formDiscount.code ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç':'‡πÄ‡∏û‡∏¥‡πà‡∏°'}</button>
                                            {editMode && <button onClick={()=>{setEditMode(null); setFormDiscount({code:'',type:'FIXED',value:''})}} className="text-gray-500 text-sm">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>}
                                        </div>
                                        <ul className="divide-y max-h-40 overflow-y-auto">
                                            {settings.discounts.map((d, i) => (
                                                <li key={i} className="flex justify-between items-center p-2 text-sm">
                                                    <span><b>{d.code}</b> : ‡∏•‡∏î {d.value} {d.type}</span>
                                                    <div className="flex gap-2"><button onClick={()=>startEdit('discount', d)} className="text-blue-500"><i className="fas fa-edit"></i></button><button onClick={()=>handleDeleteSetting('discount', d.id)} className="text-red-500"><i className="fas fa-trash"></i></button></div>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>

                                    {/* Closed Dates */}
                                    <div className="bg-white p-4 rounded-lg shadow border-l-4 border-red-500">
                                        <h3 className="font-bold text-lg mb-4 text-red-800"><i className="fas fa-calendar-times"></i> ‡∏ß‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h3>
                                        <div className="flex gap-2 mb-4 flex-wrap items-end bg-gray-50 p-2 rounded">
                                            <input type="date" className="border p-2 rounded text-sm" value={formClosed.date} onChange={e=>setFormClosed({...formClosed, date:e.target.value})} />
                                            <input placeholder="‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•" className="border p-2 rounded text-sm flex-1" value={formClosed.reason} onChange={e=>setFormClosed({...formClosed, reason:e.target.value})} />
                                            <button onClick={()=>handleSaveSetting('closed', formClosed)} className={`px-3 py-2 rounded text-sm text-white ${editMode?.reason===formClosed.reason ? 'bg-orange-500':'bg-red-600'}`}>{editMode?'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å':'‡∏õ‡∏¥‡∏î'}</button>
                                        </div>
                                        <ul className="divide-y max-h-40 overflow-y-auto">
                                            {settings.closed.map((c, i) => (
                                                <li key={i} className="flex justify-between items-center p-2 text-sm text-red-800">
                                                    <span>{formatThaiDate(c.date)} ({c.reason})</span>
                                                    <div className="flex gap-2"><button onClick={()=>startEdit('closed', c)} className="text-blue-500"><i className="fas fa-edit"></i></button><button onClick={()=>handleDeleteSetting('closed', c.id)} className="text-red-500"><i className="fas fa-trash"></i></button></div>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>

                                    {/* Special Dates */}
                                    <div className="bg-white p-4 rounded-lg shadow border-l-4 border-blue-800 md:col-span-2">
                                        <h3 className="font-bold text-lg mb-4 text-blue-800"><i className="fas fa-star"></i> ‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏°‡∏±‡∏î‡∏à‡∏≥ 100%)</h3>
                                        <div className="flex gap-2 mb-4 flex-wrap items-end bg-gray-50 p-2 rounded">
                                            <input type="date" className="border p-2 rounded text-sm" value={formSpecial.date} onChange={e=>setFormSpecial({...formSpecial, date:e.target.value})} />
                                            <input placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" className="border p-2 rounded text-sm flex-1" value={formSpecial.desc} onChange={e=>setFormSpecial({...formSpecial, desc:e.target.value})} />
                                            <button onClick={()=>handleSaveSetting('special', formSpecial)} className={`px-3 py-2 rounded text-sm text-white ${editMode?.desc===formSpecial.desc ? 'bg-orange-500':'bg-blue-600'}`}>{editMode?'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å':'‡πÄ‡∏û‡∏¥‡πà‡∏°'}</button>
                                        </div>
                                        <ul className="divide-y max-h-40 overflow-y-auto">
                                            {settings.special.map((s, i) => (
                                                <li key={i} className="flex justify-between items-center p-2 text-sm text-blue-800">
                                                    <span>{formatThaiDate(s.date)} ({s.desc})</span>
                                                    <div className="flex gap-2"><button onClick={()=>startEdit('special', s)} className="text-blue-500"><i className="fas fa-edit"></i></button><button onClick={()=>handleDeleteSetting('special', s.id)} className="text-red-500"><i className="fas fa-trash"></i></button></div>
                                                </li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Modals */}
                    {viewSlip && (
                        <div className="fixed inset-0 bg-black bg-opacity-95 flex items-center justify-center z-50 p-4" onClick={() => setViewSlip(null)}>
                            <div className="relative max-w-full">
                                <button className="absolute -top-10 right-0 text-white text-2xl"><i className="fas fa-times"></i></button>
                                <img src={viewSlip} className="max-w-full max-h-[80vh] rounded" referrerPolicy="no-referrer" />
                                <div className="text-center mt-4"><a href={viewSlip} target="_blank" className="text-white underline text-sm">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏°</a></div>
                            </div>
                        </div>
                    )}

                    {viewBooking && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4" onClick={() => { setViewBooking(null); setRescheduleData(null); }}>
                            <div className="bg-white p-6 rounded-lg w-full max-w-sm shadow-xl overflow-y-auto max-h-[90vh]" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-start mb-2"><h3 className="font-bold text-lg text-green-800">{viewBooking.name}</h3><StatusBadge status={viewBooking.status} /></div>
                                <p className="text-xs text-gray-400 mb-2">{viewBooking.id}</p>
                                <div className="space-y-2 text-sm text-gray-600">
                                    <p>üìû {viewBooking.phone}</p>
                                    <p>üì≤ {viewBooking.lineProfile}</p>
                                    <hr/>
                                    <p>‡πÄ‡∏Ç‡πâ‡∏≤: <b>{formatThaiDate(viewBooking.checkIn)}</b></p>
                                    <p>‡∏≠‡∏≠‡∏Å: <b>{formatThaiDate(viewBooking.checkOut)}</b></p>
                                    <div className="bg-gray-50 p-2 rounded">
                                        <p className="font-medium text-green-800 whitespace-pre-wrap">{viewBooking.rooms}</p>
                                        {viewBooking.food !== '-' && <p className="text-orange-600 mt-1">üçΩÔ∏è {viewBooking.food}</p>}
                                    </div>
                                    <div className="flex justify-between items-center pt-2"><span>‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥:</span><span className="text-red-600 font-bold text-lg">{parseInt(viewBooking.deposit).toLocaleString()} ‡∏ö.</span></div>
                                </div>
                                
                                {/* Add Food Section */}
                                <div className="mt-4 border-t pt-4">
                                    <h4 className="font-bold text-sm mb-2 text-blue-700">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h4>
                                    <div className="flex gap-2 mb-2">
                                        <select 
                                            className="border p-1 rounded text-sm flex-1" 
                                            value={selectedAddFood} 
                                            onChange={e => setSelectedAddFood(e.target.value)}
                                        >
                                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏ô‡∏π...</option>
                                            {siteSettings && siteSettings.foodMenu.map(f => (
                                                <option key={f.id} value={f.id}>{f.name} ({f.price}.-)</option>
                                            ))}
                                        </select>
                                        <input 
                                            type="number" 
                                            className="border p-1 rounded text-sm w-16" 
                                            min="1" 
                                            value={addFoodQty} 
                                            onChange={e => setAddFoodQty(e.target.value)} 
                                        />
                                    </div>
                                    
                                    {/* Warning for < 1 day */}
                                    {(() => {
                                        const checkInDate = new Date(viewBooking.checkIn);
                                        const now = new Date();
                                        const diffTime = checkInDate - now;
                                        const diffDays = diffTime / (1000 * 60 * 60 * 24);
                                        if (diffDays < 1) {
                                            return <div className="text-red-500 text-xs mb-2">* ‡πÉ‡∏Å‡∏•‡πâ‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏´‡∏•‡∏∑‡∏≠ {diffDays.toFixed(1)} ‡∏ß‡∏±‡∏ô)</div>;
                                        }
                                        return null;
                                    })()}

                                    <button onClick={handleAddFood} className="w-full py-2 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 text-sm font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</button>
                                </div>

                                <div className="mt-4 flex flex-col gap-2 border-t pt-4">
                                    {!rescheduleData ? (
                                        <button onClick={() => setRescheduleData({ id: viewBooking.id, checkIn: '', checkOut: '' })} className="w-full py-2 bg-orange-100 text-orange-700 rounded hover:bg-orange-200 font-bold"><i className="fas fa-calendar-alt mr-1"></i> ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å</button>
                                    ) : (
                                        <div className="bg-orange-50 p-3 rounded border border-orange-200">
                                            <h4 className="font-bold text-orange-800 mb-2 text-sm">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà</h4>
                                            <div className="space-y-2 mb-2">
                                                <input type="date" className="w-full border p-1 rounded text-sm" onChange={e => setRescheduleData({...rescheduleData, checkIn: e.target.value})} />
                                                <input type="date" className="w-full border p-1 rounded text-sm" onChange={e => setRescheduleData({...rescheduleData, checkOut: e.target.value})} />
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={() => setRescheduleData(null)} className="flex-1 py-1 bg-gray-200 text-gray-600 rounded text-xs">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                                                <button onClick={handleReschedule} className="flex-1 py-1 bg-orange-600 text-white rounded text-xs">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                                            </div>
                                        </div>
                                    )}
                                    {viewBooking.slip.includes('http') && <button onClick={() => setViewSlip(viewBooking.slip)} className="w-full py-2 border border-blue-500 text-blue-500 rounded hover:bg-blue-50">‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>}
                                    <button onClick={() => { setViewBooking(null); setRescheduleData(null); }} className="w-full py-2 bg-gray-200 rounded">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AdminApp />);
    </script>
</body>
</html>
