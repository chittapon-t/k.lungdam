<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥ - ‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: #f4f1ea; 
            color: #2c3e2d;
            -webkit-tap-highlight-color: transparent;
        }
        .bg-kanam { background-color: #2c3e2d; }
        .text-kanam { color: #2c3e2d; }
        
        #layout-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            background-color: #e5e7eb;
        }
        
        .hotspot {
            position: absolute;
            width: 10.5%; /* Fluid width based on container */
            aspect-ratio: 1 / 1;
            border-radius: 50%;
            border: 2px solid white;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        
        .hotspot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.8;
        }
        
        .hotspot .room-label {
            position: relative;
            z-index: 10;
            font-size: clamp(8px, 2vw, 12px);
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.3);
            width: 100%;
            text-align: center;
        }
        
        .status-available { border-color: #10b981; background-color: #10b981; }
        .status-booked { 
            border-color: #ef4444; 
            cursor: not-allowed; 
            filter: grayscale(100%); 
            opacity: 0.6; 
        }
        .status-booked::after { 
            content: '‚úï'; 
            position: absolute; 
            z-index: 20; 
            color: white; 
            font-size: 18px; 
            font-weight: bold;
        }
        .status-selected { 
            border-color: #facc15; 
            transform: scale(1.15); 
            border-width: 3px; 
            z-index: 50; 
            box-shadow: 0 0 15px rgba(250, 204, 21, 0.5);
        }
        
        .step-content { display: none; }
        .step-content.active { display: block; animation: fadeIn 0.3s ease-in-out; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .food-card { transition: all 0.2s; border: 1px solid #e5e7eb; }
        .food-card.selected { border-color: #2c3e2d; background-color: #f0fdf4; ring: 1px inset #2c3e2d; }
        
        input[type="date"]::-webkit-inner-spin-button,
        input[type="date"]::-webkit-calendar-picker-indicator {
            padding: 5px;
            cursor: pointer;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }
        .modal.show { display: flex; animation: fadeIn 0.3s; }
        .modal-content {
            background-color: #fff;
            margin: auto;
            padding: 2rem;
            border-radius: 1.5rem;
            width: 90%;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transform: scale(0.9);
            transition: transform 0.3s ease-out;
        }
        .modal.show .modal-content { transform: scale(1); }
    </style>
</head>
<body class="pb-10">
    <div id="app" class="max-w-md mx-auto bg-white min-h-screen shadow-lg relative">
        <!-- Header -->
        <div class="bg-kanam text-white p-6 text-center sticky top-0 z-[100]">
            <h1 class="text-2xl font-bold tracking-tight">‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥</h1>
            <p class="text-sm opacity-80">‡πÇ‡∏Æ‡∏°‡∏™‡πÄ‡∏ï‡∏¢‡πå & ‡∏•‡∏≤‡∏ô‡∏Å‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå</p>
        </div>

        <div class="p-4">
            <!-- Progress Bar -->
            <div class="flex justify-between mb-8 text-[10px] font-bold text-gray-400 uppercase tracking-widest">
                <div id="p-1" class="transition-colors duration-300">1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô</div>
                <div id="p-2" class="transition-colors duration-300">2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á & ‡∏≠‡∏≤‡∏´‡∏≤‡∏£</div>
                <div id="p-3" class="transition-colors duration-300">3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• & ‡∏ä‡∏≥‡∏£‡∏∞</div>
            </div>

            <!-- Step 1: Date Selection -->
            <div id="step-1" class="step-content active">
                <div class="bg-green-50 p-4 rounded-xl mb-6 border border-green-100">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <span>üìÖ</span> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å
                    </h2>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs mb-1 font-bold text-gray-500">CHECK-IN</label>
                            <input type="date" id="checkin" onchange="onCheckinChange()" class="w-full border border-gray-300 p-2.5 rounded-lg focus:ring-2 focus:ring-kanam outline-none bg-white">
                        </div>
                        <div>
                            <label class="block text-xs mb-1 font-bold text-gray-500">CHECK-OUT</label>
                            <input type="date" id="checkout" class="w-full border border-gray-300 p-2.5 rounded-lg focus:ring-2 focus:ring-kanam outline-none bg-white">
                        </div>
                    </div>
                    <p class="text-[10px] text-gray-400 mt-3">* ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà 14:00 ‡∏ô. ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏Å‡πà‡∏≠‡∏ô 12:00 ‡∏ô.</p>
                </div>
                <button onclick="goToStep(2)" class="w-full bg-kanam text-white py-4 rounded-xl font-bold shadow-lg active:scale-95 transition-all">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á</button>
            </div>

            <!-- Step 2: Layout Plan & Food Selection -->
            <div id="step-2" class="step-content">
                <h2 class="text-lg font-bold mb-4 text-center text-kanam">‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</h2>
                <div id="layout-container" class="mb-6">
                    <!-- ‡∏£‡∏π‡∏õ‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á -->
                    <img src="https://lh3.googleusercontent.com/pw/AP1GczNzsJplv6jr4mDDSC8wsMLS6T8-qOXwcOW3nE2yXJ-z5WWRWw7Q2XssA87-tUh6NFuStIUbPxYcOzjup6jSEpgEG1rOs2vMQ0VZ3AcKP4-qisvj7gLWcZlP0p4YRJoWYBbLQpy7kcuuSoGHeP9c2Hmq=w913-h913-s-no-gm?authuser=0" class="w-full h-auto block" alt="‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏Ç‡∏ô‡∏≥‡∏•‡∏∏‡∏á‡∏î‡∏≥">
                    <!-- Hotspots ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>

                <div class="flex justify-center gap-4 mb-6 text-[10px] font-bold">
                    <div class="flex items-center gap-1"><span class="w-3 h-3 bg-green-500 rounded-full"></span> ‡∏ß‡πà‡∏≤‡∏á</div>
                    <div class="flex items-center gap-1"><span class="w-3 h-3 bg-gray-500 rounded-full"></span> ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á</div>
                    <div class="flex items-center gap-1"><span class="w-3 h-3 bg-yellow-400 rounded-full"></span> ‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
                </div>

                <h3 class="font-bold text-kanam mb-3 flex items-center gap-2">
                    <span>üè†</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                </h3>
                <div id="selected-rooms-list" class="space-y-3 mb-6">
                    <div class="text-center py-6 text-gray-400 text-sm italic border-2 border-dashed rounded-xl bg-gray-50">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>
                </div>

                <!-- CAMP Section -->
                <div class="mb-8 p-4 border rounded-xl bg-white border-kanam border-opacity-10 shadow-sm">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-14 h-14 rounded-lg bg-gray-100 overflow-hidden border border-gray-200">
                                <img src="https://lh3.googleusercontent.com/pw/AP1GczOP3McLJXLMt2R9_tx3Jk1fIORM8V1ZCfAlQs8s0xmWQYtIsLjrWwwirDArp-aBNnFRWH-2iHze-FZPCxyerHW8nmLiI-MsW9nYChcatvL7ZPpUp63zDmO650f1C0aSZSnfzSOGW-R6_NRhyDbpgMwd=w1216-h913-s-no-gm?authuser=0" class="w-full h-full object-cover" alt="CAMP">
                            </div>
                            <div>
                                <span class="font-bold text-sm block">‡∏•‡∏≤‡∏ô‡∏Å‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå (CAMP)</span>
                                <p class="text-[11px] text-green-600 font-bold">‡∏ø150 / ‡∏ó‡πà‡∏≤‡∏ô</p>
                            </div>
                        </div>
                        <div class="flex flex-col items-center bg-gray-50 p-2 rounded-lg border">
                            <span class="text-[9px] text-gray-400 mb-1 font-bold uppercase">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô</span>
                            <div class="flex items-center gap-3">
                                <button onclick="updateCampPax(-1)" class="w-8 h-8 bg-white border border-gray-300 rounded-full shadow-sm flex items-center justify-center font-bold text-kanam active:bg-gray-100">-</button>
                                <input type="number" id="camp-pax" value="0" readonly class="w-6 bg-transparent text-center font-bold text-kanam outline-none">
                                <button onclick="updateCampPax(1)" class="w-8 h-8 bg-white border border-gray-300 rounded-full shadow-sm flex items-center justify-center font-bold text-kanam active:bg-gray-100">+</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FOOD Section -->
                <div class="mb-6">
                    <h3 class="font-bold text-kanam mb-3 flex justify-between items-center">
                        <span class="flex items-center gap-2"><span>üç≤</span> ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</span>
                        <span class="text-[10px] font-normal text-gray-400 italic">(‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡πá‡πÑ‡∏î‡πâ)</span>
                    </h3>
                    <div id="food-list" class="grid grid-cols-1 gap-3">
                        <!-- Foods list -->
                    </div>
                </div>

                <div class="flex gap-3 mt-8 sticky bottom-4">
                    <button onclick="goToStep(1)" class="w-1/3 bg-white border border-kanam text-kanam py-4 rounded-xl font-bold active:bg-gray-50">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
                    <button onclick="goToStep(3)" class="w-2/3 bg-kanam text-white py-4 rounded-xl font-bold shadow-lg active:scale-95 transition-all">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏à‡∏≠‡∏á</button>
                </div>
            </div>

            <!-- Step 3: Summary & Payment -->
            <div id="step-3" class="step-content">
                <div id="booking-summary" class="bg-white p-5 rounded-2xl mb-6 text-sm border border-gray-100 shadow-md">
                    <!-- Summary content -->
                </div>

                <!-- Promo Code -->
                <div class="mb-6 bg-white p-4 border border-dashed border-kanam border-opacity-30 rounded-xl">
                    <label class="block text-[10px] font-bold text-gray-400 mb-2 uppercase tracking-tighter">‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (PROMO CODE)</label>
                    <div class="flex gap-2">
                        <input type="text" id="promo-code" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà" class="flex-1 border border-gray-200 p-3 rounded-xl text-sm outline-none focus:border-kanam">
                        <button onclick="applyPromo()" class="bg-gray-800 text-white px-5 py-3 rounded-xl text-sm font-bold active:scale-95 transition-all">‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î</button>
                    </div>
                    <p id="promo-msg" class="text-[10px] mt-2 font-bold"></p>
                </div>

                <div class="space-y-4 mb-8">
                    <h3 class="font-bold text-kanam flex items-center gap-2"><span>üë§</span> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</h3>
                    <input type="text" id="cust-name" oninput="validateForm()" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á)" class="w-full border border-gray-200 p-4 rounded-xl focus:ring-2 focus:ring-kanam outline-none">
                    <input type="tel" id="cust-phone" oninput="validateForm()" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå" class="w-full border border-gray-200 p-4 rounded-xl focus:ring-2 focus:ring-kanam outline-none">
                    <textarea id="cust-note" placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" class="w-full border border-gray-200 p-4 rounded-xl focus:ring-2 focus:ring-kanam outline-none" rows="2"></textarea>
                </div>

                <div class="mt-8 border-t border-gray-100 pt-6 text-center">
                    <h3 class="font-bold mb-4 text-lg">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥</h3>
                    <div class="bg-white border-2 border-dashed border-gray-200 p-6 text-center rounded-3xl shadow-sm inline-block w-full">
                        <img id="qr-code" src="" class="mx-auto w-56 mb-4 rounded-xl shadow-md">
                        <div class="bg-green-50 py-3 rounded-2xl px-8 mb-4 inline-block border border-green-100">
                             <p class="text-[11px] text-green-600 mb-1 font-bold">‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞</p>
                             <p class="text-3xl font-bold text-kanam">‡∏ø<span id="deposit-text">0</span></p>
                        </div>
                        <div class="text-sm text-gray-600 font-bold space-y-1">
                            <p class="text-xs opacity-60">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå</p>
                            <p class="text-lg">061-592-4262</p>
                            <p class="text-kanam">‡∏≠‡∏•‡∏á‡∏Å‡∏ï ‡∏ó‡∏ß‡∏µ‡∏ú‡πà‡∏≠‡∏á</p>
                        </div>
                    </div>
                    
                    <div class="text-left mt-6">
                        <label class="block text-sm font-bold text-kanam mb-2">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</label>
                        <div class="relative border-2 border-dashed border-gray-500 rounded-xl p-4 bg-gray-5 text-center">
                            <input type="file" id="slip-file" onchange="validateForm()" accept="image/*" class="w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-kanam file:text-white hover:file:bg-opacity-80 cursor-pointer">
                        </div>
                    </div>
                </div>

                <div class="mt-6 flex items-start bg-amber-50 p-4 rounded-xl border border-amber-100">
                    <input type="checkbox" id="terms" onchange="validateForm()" class="mt-1 mr-3 scale-150 accent-kanam">
                    <label for="terms" class="text-[11px] text-amber-900 leading-relaxed font-medium">
                        ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏°‡∏±‡∏î‡∏à‡∏≥‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å‡πÑ‡∏î‡πâ(‡πÅ‡∏à‡πâ‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ 7 ‡∏ß‡∏±‡∏ô) ‡∏Å‡∏£‡∏ì‡∏µ‡πÇ‡∏£‡∏Ñ‡∏£‡∏∞‡∏ö‡∏≤‡∏î/‡∏†‡∏±‡∏¢‡∏û‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î
                    </label>
                </div>

                <button id="btn-submit" disabled onclick="submitBooking()" class="w-full bg-gray-300 text-white py-5 rounded-2xl mt-8 font-bold text-lg shadow-xl transition-all">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
            </div>
        </div>

        <!-- Success Modal -->
        <div id="success-modal" class="modal">
            <div class="modal-content">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-4xl">‚úÖ</span>
                </div>
                <h3 class="text-2xl font-bold text-kanam mb-2">‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
                <p class="text-gray-500 mb-6 text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</p>
                <button onclick="closeLiff()" class="w-full bg-kanam text-white py-3 rounded-xl font-bold shadow-lg hover:opacity-90 transition-all">
                    ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ä‡∏ó
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const API_URL = "https://script.google.com/macros/s/AKfycbwQjaz5oaVekrtSlw_kGqt9gLOg0uQeXphG4H2Q5cqrv4ZSEiJnzO63lctvaaYTRr9HNQ/exec"; 
        const LIFF_ID = "2008803474-hRJaVbm7";
        
        // --- STATE ---
        let masterData = { rooms: [], foods: [], promotions: [], specialDates: [] };
        let selectedRooms = []; 
        let selectedFoods = []; // { foodID, qty }
        let bookedRoomIDs = [];
        let userProfile = {};
        let appliedPromo = null;
        let finalCalculation = { total: 0, deposit: 0, discount: 0 };

        // --- INITIALIZATION ---
        async function init() {
            setInitialDates();
            try {
                // 1. Initialize LIFF
                await liff.init({ liffId: LIFF_ID });
                if (liff.isLoggedIn()) { 
                    userProfile = await liff.getProfile(); 
                } else { 
                    // liff.login(); // ‡∏õ‡∏¥‡∏î‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ö‡∏ô Browser ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                }
                
                // 2. Fetch Master Data from AppScript
                const res = await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: 'getInitialData' })
                });
                masterData = await res.json();
                
                // 3. Render UI Components
                renderHotspots();
                renderFoodList();
                
            } catch (err) { 
                console.error("Initialization failed", err); 
            }
        }

        function setInitialDates() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const cinInput = document.getElementById('checkin');
            const coutInput = document.getElementById('checkout');
            
            const minStr = tomorrow.toISOString().split('T')[0];
            cinInput.setAttribute('min', minStr);
            cinInput.value = minStr;
            onCheckinChange();
        }

        function onCheckinChange() {
            const cin = document.getElementById('checkin').value;
            const coutInput = document.getElementById('checkout');
            if (cin) {
                const nextDay = new Date(cin);
                nextDay.setDate(nextDay.getDate() + 1);
                const minOut = nextDay.toISOString().split('T')[0];
                coutInput.setAttribute('min', minOut);
                coutInput.value = minOut;
            }
        }

        // --- RENDERERS ---
        function renderHotspots() {
            const container = document.getElementById('layout-container');
            // ‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏´‡∏°‡πà)
            container.querySelectorAll('.hotspot').forEach(h => h.remove());

            masterData.rooms.forEach(room => {
                if (room.id === 'CAMP') return; // CAMP ‡πÅ‡∏¢‡∏Å UI ‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å
                
                const div = document.createElement('div');
                div.className = `hotspot status-available`;
                div.style.left = room.coords.x + '%';
                div.style.top = room.coords.y + '%';
                div.innerHTML = `
                    <img src="${room.imageUrl || 'https://via.placeholder.com/100'}" onerror="this.src='https://via.placeholder.com/100'">
                    <span class="room-label">${room.id}</span>
                `;
                div.id = `room-${room.id}`;
                div.onclick = () => toggleRoom(room.id);
                container.appendChild(div);
            });
        }

        function renderFoodList() {
            const container = document.getElementById('food-list');
            if (!masterData.foods || masterData.foods.length === 0) {
                container.innerHTML = `<p class="text-xs text-gray-400 italic">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</p>`;
                return;
            }
            container.innerHTML = masterData.foods.map(food => `
                <div class="food-card p-4 rounded-xl flex justify-between items-center bg-white shadow-sm" id="food-card-${food.id}">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-green-50 rounded-full flex items-center justify-center text-2xl border border-green-100 shadow-inner">
                            ${getFoodEmoji(food.name)}
                        </div>
                        <div>
                            <p class="font-bold text-sm text-kanam">${food.name}</p>
                            <p class="text-xs text-green-600 font-bold">‡∏ø${food.price}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-3 bg-gray-50 p-1.5 rounded-full border">
                        <button onclick="updateFoodQty('${food.id}', -1)" class="w-8 h-8 bg-white border border-gray-200 rounded-full flex items-center justify-center font-bold text-kanam shadow-sm">-</button>
                        <span id="food-qty-${food.id}" class="w-4 text-center font-bold text-sm">0</span>
                        <button onclick="updateFoodQty('${food.id}', 1)" class="w-8 h-8 bg-white border border-gray-200 rounded-full flex items-center justify-center font-bold text-kanam shadow-sm">+</button>
                    </div>
                </div>
            `).join('');
        }

        function getFoodEmoji(name) {
            if (name.includes('‡∏Å‡∏£‡∏∞‡∏ó‡∏∞')) return 'ü•ò';
            if (name.includes('‡∏Å‡∏≤‡πÅ‡∏ü') || name.includes('‡∏î‡∏£‡∏¥‡∏õ')) return '‚òï';
            if (name.includes('‡∏ä‡∏≤‡∏ö‡∏π')) return 'üç≤';
            return 'üç±';
        }

        // --- LOGIC ---
        function toggleRoom(id) {
            if (bookedRoomIDs.includes(id)) return;
            const el = document.getElementById(`room-${id}`);
            const idx = selectedRooms.findIndex(r => r.id === id);
            
            if (idx > -1) {
                selectedRooms.splice(idx, 1);
                el.classList.remove('status-selected');
                el.classList.add('status-available');
            } else {
                let initialPax = (id === 'NP') ? 4 : 1;
                selectedRooms.push({ id: id, pax: initialPax });
                el.classList.remove('status-available');
                el.classList.add('status-selected');
            }
            renderSelectedRoomsList();
        }

        function renderSelectedRoomsList() {
            const list = document.getElementById('selected-rooms-list');
            if (selectedRooms.length === 0) {
                list.innerHTML = `<div class="text-center py-6 text-gray-400 text-sm italic border-2 border-dashed rounded-xl bg-gray-50">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>`;
                return;
            }
            list.innerHTML = selectedRooms.map(item => {
                const room = masterData.rooms.find(r => r.id === item.id);
                return `
                    <div class="p-3 border rounded-xl bg-white flex justify-between items-center shadow-sm border-kanam border-opacity-10">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-lg border overflow-hidden"><img src="${room.imageUrl}" class="w-full h-full object-cover"></div>
                            <div>
                                <span class="font-bold text-kanam text-sm">${room.name}</span>
                                <p class="text-[10px] text-gray-400 italic">‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${room.maxPax} ‡∏ó‡πà‡∏≤‡∏ô</p>
                            </div>
                        </div>
                        <div class="flex flex-col items-center bg-gray-50 p-1.5 rounded-lg border">
                            <span class="text-[8px] text-gray-400 font-bold uppercase mb-0.5">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô</span>
                            <div class="flex items-center gap-3">
                                <button onclick="updateRoomPax('${item.id}', -1)" class="w-7 h-7 bg-white border border-gray-200 rounded-full flex items-center justify-center font-bold text-kanam shadow-sm">-</button>
                                <span class="w-4 text-center font-bold text-sm">${item.pax}</span>
                                <button onclick="updateRoomPax('${item.id}', 1)" class="w-7 h-7 bg-white border border-gray-200 rounded-full flex items-center justify-center font-bold text-kanam shadow-sm">+</button>
                            </div>
                        </div>
                    </div>`;
            }).join('');
        }

        function updateRoomPax(id, val) {
            const item = selectedRooms.find(r => r.id === id);
            const room = masterData.rooms.find(r => r.id === id);
            let min = (id === 'NP') ? 4 : 1;
            let max = (id === 'NP') ? 8 : room.maxPax;
            let next = item.pax + val;
            if (next >= min && next <= max) {
                item.pax = next;
                renderSelectedRoomsList();
            }
        }

        function updateCampPax(val) {
            const input = document.getElementById('camp-pax');
            let next = parseInt(input.value) + val;
            if (next >= 0 && next <= 30) input.value = next;
        }

        function updateFoodQty(id, val) {
            let item = selectedFoods.find(f => f.foodID === id);
            if (!item) {
                item = { foodID: id, qty: 0 };
                selectedFoods.push(item);
            }
            item.qty = Math.max(0, item.qty + val);
            document.getElementById(`food-qty-${id}`).innerText = item.qty;
            
            const card = document.getElementById(`food-card-${id}`);
            if (item.qty > 0) card.classList.add('selected');
            else card.classList.remove('selected');
            
            if (item.qty === 0) selectedFoods = selectedFoods.filter(f => f.foodID !== id);
        }

        // --- NAVIGATION & PRICING ---
        async function goToStep(n) {
            if (n === 2) {
                // ‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ 2 ‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô
                const cin = document.getElementById('checkin').value;
                const cout = document.getElementById('checkout').value;
                if (!cin || !cout) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å");
                
                // Show loading
                document.getElementById('p-1').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...";
                await checkRoomAvailability(cin, cout);
                document.getElementById('p-1').innerText = "1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô";
            }
            
            if (n === 3) {
                const cp = parseInt(document.getElementById('camp-pax').value);
                if (selectedRooms.length === 0 && cp === 0) {
                    return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡πâ‡∏≤‡∏ô‡∏û‡∏±‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡∏Å‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå");
                }
                calculatePricing();
            }
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ UI
            document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`step-${n}`).classList.add('active');
            
            // Update Progress bar colors
            document.querySelectorAll('[id^="p-"]').forEach(el => el.classList.remove('text-kanam'));
            for(let i=1; i<=n; i++) document.getElementById(`p-${i}`).classList.add('text-kanam');
            
            window.scrollTo(0,0);
        }

        async function checkRoomAvailability(cin, cout) {
            try {
                const res = await fetch(API_URL, { 
                    method: 'POST', 
                    body: JSON.stringify({ action: 'checkAvailability', checkIn: cin, checkOut: cout }) 
                });
                const data = await res.json();
                bookedRoomIDs = data.bookedRoomIDs || [];
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô Layout
                masterData.rooms.forEach(room => {
                    const el = document.getElementById(`room-${room.id}`);
                    if (!el) return;
                    
                    if (bookedRoomIDs.includes(room.id)) {
                        el.className = 'hotspot status-booked';
                        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏î‡∏ô‡∏à‡∏≠‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
                        selectedRooms = selectedRooms.filter(r => r.id !== room.id);
                    } else {
                        const isSel = selectedRooms.some(r => r.id === room.id);
                        el.className = 'hotspot ' + (isSel ? 'status-selected' : 'status-available');
                    }
                });
                renderSelectedRoomsList();
            } catch (e) {
                alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
            }
        }

        function calculatePricing() {
            let roomTotal = 0;
            let foodTotal = 0;
            const cin = document.getElementById('checkin').value;
            const cout = document.getElementById('checkout').value;
            
            // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (SpecialDates)
            const checkinDate = new Date(cin);
            checkinDate.setHours(0,0,0,0);
            const specialDay = masterData.specialDates?.find(s => {
                const sDate = new Date(s.date);
                sDate.setHours(0,0,0,0);
                return sDate.getTime() === checkinDate.getTime();
            });

            let summaryHtml = `
                <div class="text-center border-b pb-3 mb-4">
                    <p class="font-bold text-lg text-kanam tracking-tight">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</p>
                    <div class="flex justify-center items-center gap-2 text-[11px] text-gray-500 mt-1">
                        <span class="bg-gray-100 px-2 py-0.5 rounded">${formatDate(cin)}</span>
                        <span>‚ûû</span>
                        <span class="bg-gray-100 px-2 py-0.5 rounded">${formatDate(cout)}</span>
                    </div>
                    ${specialDay ? `<div class="bg-red-50 text-red-600 text-[10px] font-bold py-1 px-3 rounded-full inline-block mt-2 border border-red-100">‚ú® ${specialDay.event} (‡∏°‡∏±‡∏î‡∏à‡∏≥ 100%)</div>` : ''}
                </div>
                <div class="space-y-2">
            `;
            
            // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ö‡πâ‡∏≤‡∏ô
            selectedRooms.forEach(item => {
                const room = masterData.rooms.find(r => r.id === item.id);
                let price = calculateSingleRoomPrice(item.id, item.pax);
                roomTotal += price;
                summaryHtml += `
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">${room.name} (${item.pax} ‡∏ó‡πà‡∏≤‡∏ô)</span>
                        <span class="font-bold">‡∏ø${price.toLocaleString()}</span>
                    </div>`;
            });

            // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏•‡∏≤‡∏ô‡∏Å‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå
            const cp = parseInt(document.getElementById('camp-pax').value);
            if (cp > 0) {
                let cpPrice = cp * 150;
                roomTotal += cpPrice;
                summaryHtml += `
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">‡∏•‡∏≤‡∏ô‡∏Å‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå (${cp} ‡∏ó‡πà‡∏≤‡∏ô)</span>
                        <span class="font-bold">‡∏ø${cpPrice.toLocaleString()}</span>
                    </div>`;
            }

            // 4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
            let discount = 0;
            if (appliedPromo) {
                discount = (appliedPromo.type === 'percent') ? (roomTotal * (appliedPromo.value / 100)) : appliedPromo.value;
                summaryHtml += `
                    <div class="flex justify-between items-center text-green-600 font-bold bg-green-50 p-2 rounded-lg mt-2">
                        <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å (${appliedPromo.code})</span>
                        <span>-‡∏ø${discount.toLocaleString()}</span>
                    </div>`;
            }

            // 5. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£
            summaryHtml += `<div class="border-t border-gray-100 my-4 pt-3"></div><p class="text-[10px] font-bold text-gray-400 uppercase mb-2">‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</p>`;
            selectedFoods.forEach(item => {
                const food = masterData.foods.find(f => f.id === item.foodID);
                let fPrice = food.price * item.qty;
                foodTotal += fPrice;
                summaryHtml += `
                    <div class="flex justify-between items-center text-gray-500 mb-1">
                        <span>${food.name} x${item.qty}</span>
                        <span>‡∏ø${fPrice.toLocaleString()}</span>
                    </div>`;
            });
            if (selectedFoods.length === 0) summaryHtml += `<p class="text-[10px] text-gray-400 italic">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>`;

            // 6. ‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥‡πÅ‡∏•‡∏∞‡∏°‡∏±‡∏î‡∏à‡∏≥
            let finalTotal = Math.max(0, (roomTotal - discount) + foodTotal);
            let finalDeposit = 0;
            
            if (specialDay) {
                finalDeposit = finalTotal; // ‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏à‡πà‡∏≤‡∏¢ 100%
            } else {
                // ‡∏õ‡∏Å‡∏ï‡∏¥: ‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å + ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°
                finalDeposit = Math.ceil(((roomTotal - discount) * 0.5) + foodTotal);
            }

            finalCalculation = { total: finalTotal, deposit: finalDeposit, discount: discount };
            
            summaryHtml += `
                </div>
                <div class="mt-6 pt-4 border-t-2 border-kanam">
                    <div class="flex justify-between text-sm text-gray-500 mb-1">
                        <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span>
                        <span>‡∏ø${finalTotal.toLocaleString()}</span>
                    </div>
                    <div class="flex justify-between text-xl font-bold text-red-600">
                        <span>‡∏¢‡∏≠‡∏î‡∏°‡∏±‡∏î‡∏à‡∏≥</span>
                        <span>‡∏ø${finalDeposit.toLocaleString()}</span>
                    </div>
                    <p class="text-[9px] text-gray-400 text-right mt-2 font-medium italic">
                        ${specialDay ? '* ‡∏ß‡∏±‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©/‡πÄ‡∏ó‡∏®‡∏Å‡∏≤‡∏• ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô' : '* ‡∏°‡∏±‡∏î‡∏à‡∏≥ 50% ‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å + ‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô'}
                    </p>
                </div>`;
            
            document.getElementById('booking-summary').innerHTML = summaryHtml;
            document.getElementById('deposit-text').innerText = finalDeposit.toLocaleString();
            document.getElementById('qr-code').src = `https://promptpay.io/0615924262/${finalDeposit}`;
            validateForm();
        }

        function calculateSingleRoomPrice(id, pax) {
            // Logic ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô (Business Logic)
            if (id === 'NP') return pax >= 6 ? 2200 : 1600;
            if (id.startsWith('RN')) return pax === 3 ? 1750 : 1400;
            if (id.startsWith('G')) return pax >= 3 ? 1550 : 1200;
            
            // ‡∏ñ‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏ß‡πâ‡πÉ‡∏ô masterData ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡πâ‡∏ô
            const rData = masterData.rooms.find(r => r.id === id);
            return rData ? rData.basePrice : 0;
        }

        function formatDate(dateStr) {
            if(!dateStr) return "-";
            const d = new Date(dateStr);
            return d.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: '2-digit' });
        }

        function applyPromo() {
            const code = document.getElementById('promo-code').value.trim().toUpperCase();
            const msg = document.getElementById('promo-msg');
            const promo = masterData.promotions?.find(p => p.code === code);

            if (!code) { appliedPromo = null; calculatePricing(); return; }

            if (promo) {
                appliedPromo = promo;
                msg.innerText = "‚úì ‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + promo.code;
                msg.className = "text-[10px] mt-2 text-green-600 font-bold";
            } else {
                appliedPromo = null;
                msg.innerText = "‚úï ‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏";
                msg.className = "text-[10px] mt-2 text-red-600 font-bold";
            }
            calculatePricing();
        }

        // --- SUBMISSION ---
        function validateForm() {
            const name = document.getElementById('cust-name').value.trim();
            const phone = document.getElementById('cust-phone').value.trim();
            const slip = document.getElementById('slip-file').files.length > 0;
            const terms = document.getElementById('terms').checked;
            const btn = document.getElementById('btn-submit');
            
            if (name && phone && slip && terms) {
                btn.disabled = false;
                btn.className = "w-full bg-kanam text-white py-5 rounded-2xl mt-8 font-bold text-lg shadow-xl active:scale-95 transition-all cursor-pointer";
            } else {
                btn.disabled = true;
                btn.className = "w-full bg-gray-300 text-white py-5 rounded-2xl mt-8 font-bold text-lg shadow-none cursor-not-allowed";
            }
        }

        async function submitBooking() {
            const btn = document.getElementById('btn-submit');
            btn.disabled = true;
            btn.innerHTML = `<span class="inline-block animate-spin mr-2">‚è≥</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á...`;

            const fileInput = document.getElementById('slip-file');
            const reader = new FileReader();
            reader.readAsDataURL(fileInput.files[0]);
            reader.onload = async () => {
                const payload = {
                    action: 'createBooking',
                    checkIn: document.getElementById('checkin').value,
                    checkOut: document.getElementById('checkout').value,
                    customer: { 
                        name: document.getElementById('cust-name').value, 
                        // ‡πÄ‡∏û‡∏¥‡πà‡∏° ' ‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏Ç 0 ‡∏´‡∏≤‡∏¢
                        phone: "'" + document.getElementById('cust-phone').value, 
                        lineID: userProfile.userId || 'Guest',
                        note: document.getElementById('cust-note').value
                    },
                    rooms: [
                        ...selectedRooms.map(r => ({ 
                            roomID: r.id, 
                            pax: r.pax, 
                            price: calculateSingleRoomPrice(r.id, r.pax) 
                        })),
                        ...(parseInt(document.getElementById('camp-pax').value) > 0 ? [{ 
                            roomID: 'CAMP', 
                            pax: document.getElementById('camp-pax').value, 
                            price: 150 
                        }] : [])
                    ],
                    foods: selectedFoods.map(f => ({ 
                        foodID: f.foodID, 
                        qty: f.qty, 
                        price: masterData.foods.find(mf => mf.id === f.foodID).price 
                    })),
                    promoCode: appliedPromo ? appliedPromo.code : "",
                    totalPrice: finalCalculation.total,
                    deposit: finalCalculation.deposit,
                    slipBase64: reader.result,
                    lineName: userProfile.displayName || ''
                };
                
                try {
                    const res = await fetch(API_URL, { 
                        method: 'POST', 
                        body: JSON.stringify(payload) 
                    });
                    const result = await res.json();
                    
                    if (result.status === 'success') { 
                        // ‡πÅ‡∏™‡∏î‡∏á Modal ‡πÅ‡∏ó‡∏ô alert
                        document.getElementById('success-modal').classList.add('show');
                    } else { 
                        alert("‚ùå ‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢: " + result.message); 
                        btn.disabled = false;
                        btn.innerHTML = `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á`;
                    }
                } catch(e) {
                    alert("‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á");
                    btn.disabled = false;
                    btn.innerHTML = `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á`;
                }
            };
        }

        function closeLiff() {
            liff.closeWindow();
        }

        // Start App
        init();
    </script>
</body>
</html>
